
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8. Ezgi Analizi - Temel titreşim frekans kestirimi &#8212; Python Ile Ses İşlemeye Giriş</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Entonasyon Analizi" href="9_EntonasyonAnalizi.html" />
    <link rel="prev" title="7. Akustik Öznitelikler ile Otomatik Enstrüman Tanıma" href="7_OtomatikEnstrumanTanima.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Python Ile Ses İşlemeye Giriş</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0_Giris.html">
                    Python ile Ses İşlemeye Giriş
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Python ile sayısal sinyal işlemeye giriş
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_TemelSinyaller_TemelIslemler.html">
   1. Temel Sinyaller, Temel İşlemler
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Sayısal Sistemler
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2_SayisalSistemlereGiris.html">
   2. Sayısal Sistemlere Giriş
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_ZDonusumuVeSistemler.html">
   3. Z-Dönüşümü ve Sistemler
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spektrum Analizi
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="4_SinyallerinFrekansSpektrumAnalizi.html">
   4. Sinyal spektrum analizi
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5_MuzikSinyalleriSpektrumu.html">
   5. Müzik sinyalleri spektrum analizi
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Müzik sinyali analiz: akustik öznitelikler
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="6_AkustikParam_LowLevelFeats.html">
   6. Müzik sinyali akustik özniteliklere giriş
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7_OtomatikEnstrumanTanima.html">
   7. Akustik öznitelikler ile otomatik enstrüman tanıma
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Müzik ezgi boyutu analizi
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   8. Temel titreşim frekans kestirimi
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="9_EntonasyonAnalizi.html">
   9. Entonasyon Analizi
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Müzik ritim boyutu analizi
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10_RitmikAnaliz.html">
   10. Ritmik Analiz
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ekler
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Ek1_PythonHizliTekrar.html">
   Ek-1 Python Hızlı Tekrar
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Ek2_NumpyHizliTekrar.html">
   Ek-2 Numpy Hızlı Tekrar
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Ek3_sayisalFiltreler.html">
   Ek-3 Sayısal Filtreler
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ses-isleme/ses-isleme.github.io/master?urlpath=tree/https://ses-isleme.github.io/notebooks/8_EzgiAnalizi_FrekansKestirimi.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ses-isleme/ses-isleme.github.io"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ses-isleme/ses-isleme.github.io/issues/new?title=Issue%20on%20page%20%2Fnotebooks/8_EzgiAnalizi_FrekansKestirimi.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/8_EzgiAnalizi_FrekansKestirimi.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   8.1. Ezgi Analizi - Temel Titreşim Frekans Kestirimi
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#frekans-kestirim-algoritmasinin-test-edilmesi">
     8.1.1. Frekans kestirim algoritmasının test edilmesi
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#baska-ozniteliklerle-ornegin-spektrogram-ile-karsilastirmak">
       8.1.1.1. Başka özniteliklerle (örneğin spektrogram ile) karşılaştırmak
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cesitli-yontemlerin-standart-metrikler-kullanilarak-test-edilmesi">
       8.1.1.2. Çeşitli yöntemlerin standart metrikler kullanılarak test edilmesi
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Ezgi Analizi - Temel titreşim frekans kestirimi</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   8.1. Ezgi Analizi - Temel Titreşim Frekans Kestirimi
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#frekans-kestirim-algoritmasinin-test-edilmesi">
     8.1.1. Frekans kestirim algoritmasının test edilmesi
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#baska-ozniteliklerle-ornegin-spektrogram-ile-karsilastirmak">
       8.1.1.1. Başka özniteliklerle (örneğin spektrogram ile) karşılaştırmak
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cesitli-yontemlerin-standart-metrikler-kullanilarak-test-edilmesi">
       8.1.1.2. Çeşitli yöntemlerin standart metrikler kullanılarak test edilmesi
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="ezgi-analizi-temel-titresim-frekans-kestirimi">
<h1><span class="section-number">8. </span>Ezgi Analizi - Temel titreşim frekans kestirimi<a class="headerlink" href="#ezgi-analizi-temel-titresim-frekans-kestirimi" title="Permalink to this headline">#</a></h1>
<p><a href="https://colab.research.google.com/drive/1jSlFKAiTqLXveHV6MekuzNyX8wcZzoKu?usp=sharing" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<section id="id1">
<h2><span class="section-number">8.1. </span>Ezgi Analizi - Temel Titreşim Frekans Kestirimi<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h2>
<p>Müzik sinyallerinde en önemli boyutlardan birisi ezgi boyutudur. İlk olarak 5. defterimizde spektrogramdan kromagram temsili elde ederek bir tür (oktav olarak katlanmış) ezgi temsili elde etmiştik. Bu defterimizde hedefimiz bir kayıt içerisinde icra edilen frekansları kestirmek (İng: estimate) için fonksiyon yazmak. Anlaşılabilir bir içerik sunabilmek için bu defterde bir anda sadece tek notanın icra edildiği (monofonik) kayıtları ele alacağız.</p>
<p>Önceki defterlerimizde ses sinyalinin karakteristiğinin zamanla değiştiğini ve bu nedenle sinyalimizi küçük parçalara ayırarak analiz yapmayı tercih ettiğimizi belirtmiştik. Örneğin 6. defterimizde sinyalimizi ardışık küçük kesitlere/pencerelere ayırmış ve her bir kesit için parametre (enerji, sıfır kesim oranı, spektral merkez, vb.) kestirimi gerçekleştirmiştik. Bu defterimizde de aynı şekilde sinyallerimizi küçük kesitlere ayıracak ve her küçük kesit için bir temel titreşim frekans değeri kestirmeye çalışacağız.</p>
<p>Temel titreşim frekansı (İng: <a class="reference external" href="https://en.wikipedia.org/wiki/Fundamental_frequency">fundamental frequency</a>), monofonik bir ses sinyalinden alınan bir kesitte ana dalga formunun saniyedeki tekrar sayısı olarak düşünülebilir. Kütüphanelerimizi yükleyelim ve daha sonra bir ses örneği yükleyip inceleyelim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">librosa</span>
<span class="kn">import</span> <span class="nn">soundfile</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">get_window</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Audio</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ses verisi okuma ve Melodia aracı ile frekans kestirimi için Essentia paketinin kurulumu ve yüklenmesi</span>
<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="k">if</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="s1">&#39;essentia&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
  <span class="o">!</span>pip install essentia
<span class="kn">import</span> <span class="nn">essentia.standard</span> <span class="k">as</span> <span class="nn">ess</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[   INFO   ] MusicExtractorSVM: no classifier models were configured by default
</pre></div>
</div>
</div>
</div>
<p>İncelemek için bir dizi ses kaydı indirelim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># UIOWA:MIS veri kümesi bağlantı adresleri</span>
<span class="n">baglantilar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;flute&#39;</span><span class="p">:</span> <span class="s1">&#39;http://theremin.music.uiowa.edu/sound</span><span class="si">%20f</span><span class="s1">iles/MIS/Woodwinds/flute/flute.nonvib.ff.zip&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">veri_klasoru</span> <span class="o">=</span> <span class="s1">&#39;enstruman&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">veri_klasoru</span><span class="p">):</span>  <span class="c1"># klasör yok ise oluşturalım</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">veri_klasoru</span><span class="p">)</span>
<span class="k">for</span> <span class="n">enstruman</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">baglantilar</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">enstruman</span><span class="p">,</span> <span class="s1">&#39;için dosyaları indiriyor&#39;</span><span class="p">)</span>
    <span class="n">hedef_klasor</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">veri_klasoru</span><span class="p">,</span> <span class="n">enstruman</span><span class="p">)</span>
    <span class="c1"># enstrüman için altklasör yok ise oluşturalım</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">hedef_klasor</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">hedef_klasor</span><span class="p">)</span>
    <span class="n">dosya_ismi</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dosya_ismi</span><span class="p">)</span>
    <span class="c1"># Zip dosyasının açılması</span>
    <span class="n">zip_ref</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">dosya_ismi</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">hedef_klasor</span><span class="p">)</span>
    <span class="n">zip_ref</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dosya_ismi</span><span class="p">)</span>  <span class="c1"># açılmış zip dosyasının silinmesi</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Veri indirildi, açıldı ve yerleştirildi: &#39;</span><span class="p">,</span> <span class="n">hedef_klasor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>flute için dosyaları indiriyor
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Veri indirildi, açıldı ve yerleştirildi:  enstruman/flute
</pre></div>
</div>
</div>
</div>
<p>Standart nota frekanslarını da bir tablodan okuyalım.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># csv dosyasını okumak için pandas kütüphanesini kullanalım</span>
<span class="n">nota_fr_tablo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://github.com/barisbozkurt/dataDumpForCourses/raw/master/noteFrequencies.csv&#39;</span><span class="p">)</span>
<span class="c1"># Tabloyu pandas-dataFrame&#39;den kütüphaneye dönüştürelim</span>
<span class="n">nota_frekanslari</span> <span class="o">=</span> <span class="p">{</span><span class="n">nota_fr_tablo</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;notes&#39;</span><span class="p">]:</span><span class="n">nota_fr_tablo</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;frequencies&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nota_fr_tablo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nota_frekanslari</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;C0&#39;: 16.35, &#39;C#0&#39;: 17.32, &#39;Db0&#39;: 17.32, &#39;D0&#39;: 18.35, &#39;D#0&#39;: 19.45, &#39;Eb0&#39;: 19.45, &#39;E0&#39;: 20.6, &#39;F0&#39;: 21.83, &#39;F#0&#39;: 23.12, &#39;Gb0&#39;: 23.12, &#39;G0&#39;: 24.5, &#39;G#0&#39;: 25.96, &#39;Ab0&#39;: 25.96, &#39;A0&#39;: 27.5, &#39;A#0&#39;: 29.14, &#39;Bb0&#39;: 29.14, &#39;B0&#39;: 30.87, &#39;C1&#39;: 32.7, &#39;C#1&#39;: 34.65, &#39;Db1&#39;: 34.65, &#39;D1&#39;: 36.71, &#39;D#1&#39;: 38.89, &#39;Eb1&#39;: 38.89, &#39;E1&#39;: 41.2, &#39;F1&#39;: 43.65, &#39;F#1&#39;: 46.25, &#39;Gb1&#39;: 46.25, &#39;G1&#39;: 49.0, &#39;G#1&#39;: 51.91, &#39;Ab1&#39;: 51.91, &#39;A1&#39;: 55.0, &#39;A#1&#39;: 58.27, &#39;Bb1&#39;: 58.27, &#39;B1&#39;: 61.74, &#39;C2&#39;: 65.41, &#39;C#2&#39;: 69.3, &#39;Db2&#39;: 69.3, &#39;D2&#39;: 73.42, &#39;D#2&#39;: 77.78, &#39;Eb2&#39;: 77.78, &#39;E2&#39;: 82.41, &#39;F2&#39;: 87.31, &#39;F#2&#39;: 92.5, &#39;Gb2&#39;: 92.5, &#39;G2&#39;: 98.0, &#39;G#2&#39;: 103.83, &#39;Ab2&#39;: 103.83, &#39;A2&#39;: 110.0, &#39;A#2&#39;: 116.54, &#39;Bb2&#39;: 116.54, &#39;B2&#39;: 123.47, &#39;C3&#39;: 130.81, &#39;C#3&#39;: 138.59, &#39;Db3&#39;: 138.59, &#39;D3&#39;: 146.83, &#39;D#3&#39;: 155.56, &#39;Eb3&#39;: 155.56, &#39;E3&#39;: 164.81, &#39;F3&#39;: 174.61, &#39;F#3&#39;: 185.0, &#39;Gb3&#39;: 185.0, &#39;G3&#39;: 196.0, &#39;G#3&#39;: 207.65, &#39;Ab3&#39;: 207.65, &#39;A3&#39;: 220.0, &#39;A#3&#39;: 233.08, &#39;Bb3&#39;: 233.08, &#39;B3&#39;: 246.94, &#39;C4&#39;: 261.63, &#39;C#4&#39;: 277.18, &#39;Db4&#39;: 277.18, &#39;D4&#39;: 293.66, &#39;D#4&#39;: 311.13, &#39;Eb4&#39;: 311.13, &#39;E4&#39;: 329.63, &#39;F4&#39;: 349.23, &#39;F#4&#39;: 369.99, &#39;Gb4&#39;: 369.99, &#39;G4&#39;: 392.0, &#39;G#4&#39;: 415.3, &#39;Ab4&#39;: 415.3, &#39;A4&#39;: 440.0, &#39;A#4&#39;: 466.16, &#39;Bb4&#39;: 466.16, &#39;B4&#39;: 493.88, &#39;C5&#39;: 523.25, &#39;C#5&#39;: 554.37, &#39;Db5&#39;: 554.37, &#39;D5&#39;: 587.33, &#39;D#5&#39;: 622.25, &#39;Eb5&#39;: 622.25, &#39;E5&#39;: 659.25, &#39;F5&#39;: 698.46, &#39;F#5&#39;: 739.99, &#39;Gb5&#39;: 739.99, &#39;G5&#39;: 783.99, &#39;G#5&#39;: 830.61, &#39;Ab5&#39;: 830.61, &#39;A5&#39;: 880.0, &#39;A#5&#39;: 932.33, &#39;Bb5&#39;: 932.33, &#39;B5&#39;: 987.77, &#39;C6&#39;: 1046.5, &#39;C#6&#39;: 1108.73, &#39;Db6&#39;: 1108.73, &#39;D6&#39;: 1174.66, &#39;D#6&#39;: 1244.51, &#39;Eb6&#39;: 1244.51, &#39;E6&#39;: 1318.51, &#39;F6&#39;: 1396.91, &#39;F#6&#39;: 1479.98, &#39;Gb6&#39;: 1479.98, &#39;G6&#39;: 1567.98, &#39;G#6&#39;: 1661.22, &#39;Ab6&#39;: 1661.22, &#39;A6&#39;: 1760.0, &#39;A#6&#39;: 1864.66, &#39;Bb6&#39;: 1864.66, &#39;B6&#39;: 1975.53, &#39;C7&#39;: 2093.0, &#39;C#7&#39;: 2217.46, &#39;Db7&#39;: 2217.46, &#39;D7&#39;: 2349.32, &#39;D#7&#39;: 2489.02, &#39;Eb7&#39;: 2489.02, &#39;E7&#39;: 2637.02, &#39;F7&#39;: 2793.83, &#39;F#7&#39;: 2959.96, &#39;Gb7&#39;: 2959.96, &#39;G7&#39;: 3135.96, &#39;G#7&#39;: 3322.44, &#39;Ab7&#39;: 3322.44, &#39;A7&#39;: 3520.0, &#39;A#7&#39;: 3729.31, &#39;Bb7&#39;: 3729.31, &#39;B7&#39;: 3951.07, &#39;C8&#39;: 4186.01, &#39;C#8&#39;: 4434.92, &#39;Db8&#39;: 4434.92, &#39;D8&#39;: 4698.63, &#39;D#8&#39;: 4978.03, &#39;Eb8&#39;: 4978.03, &#39;E8&#39;: 5274.04, &#39;F8&#39;: 5587.65, &#39;F#8&#39;: 5919.91, &#39;Gb8&#39;: 5919.91, &#39;G8&#39;: 6271.93, &#39;G#8&#39;: 6644.88, &#39;Ab8&#39;: 6644.88, &#39;A8&#39;: 7040.0, &#39;A#8&#39;: 7458.62, &#39;Bb8&#39;: 7458.62, &#39;B8&#39;: 7902.13}
</pre></div>
</div>
</div>
</div>
<p>Şimdi indirdiğimiz kayıtlardan birisinin ilk notasının bir bölümünü inceleyelim. Bu kayıtta C5 ve B5 arasındaki notalar sırasıyla flüt ile icra edilmiş. İlk olarak sadece ilk 3 saniyelik kısmı kesip inceleyelim</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ornekleme_fr</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="n">muzik_sinyali</span> <span class="o">=</span> <span class="n">ess</span><span class="o">.</span><span class="n">MonoLoader</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;/content/enstruman/flute/flute.nonvib.ff.C5B5.aiff&#39;</span><span class="p">,</span> <span class="n">sampleRate</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">)()</span>

<span class="c1"># Kaydın ilk 3 saniyelik bölümünü alalım, bu bölümde C5 notası icra edilmiş </span>
<span class="n">sure_saniye</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">muzik_sinyali_3s</span> <span class="o">=</span> <span class="n">muzik_sinyali</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="o">*</span><span class="n">sure_saniye</span><span class="p">)]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muzik_sinyali_3s</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flüt sinyali örneği (C5 notası icrası)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;zaman endeksi (n)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;x[n]&#39;</span><span class="p">);</span>
<span class="n">Audio</span><span class="p">(</span><span class="n">muzik_sinyali_3s</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_33071</span><span class="o">/</span><span class="mf">3513546028.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">ornekleme_fr</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">muzik_sinyali</span> <span class="o">=</span> <span class="n">ess</span><span class="o">.</span><span class="n">MonoLoader</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;/content/enstruman/flute/flute.nonvib.ff.C5B5.aiff&#39;</span><span class="p">,</span> <span class="n">sampleRate</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">)()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Kaydın ilk 3 saniyelik bölümünü alalım, bu bölümde C5 notası icra edilmiş</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">sure_saniye</span> <span class="o">=</span> <span class="mi">3</span>

<span class="nn">~/miniconda3/envs/KitapYazim/lib/python3.9/site-packages/essentia/standard.py</span> in <span class="ni">__init__</span><span class="nt">(self, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span> 
<span class="g g-Whitespace">     </span><span class="mi">43</span>             <span class="c1"># configure the algorithm</span>
<span class="ne">---&gt; </span><span class="mi">44</span>             <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> 
<span class="g g-Whitespace">     </span><span class="mi">46</span>         <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

<span class="nn">~/miniconda3/envs/KitapYazim/lib/python3.9/site-packages/essentia/standard.py</span> in <span class="ni">configure</span><span class="nt">(self, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>                 <span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">convertedVal</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span> 
<span class="ne">---&gt; </span><span class="mi">64</span>             <span class="bp">self</span><span class="o">.</span><span class="n">__configure__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span> 
<span class="g g-Whitespace">     </span><span class="mi">66</span>         <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>

<span class="ne">RuntimeError</span>: Error while configuring MonoLoader: AudioLoader: Could not open file &quot;/content/enstruman/flute/flute.nonvib.ff.C5B5.aiff&quot;, error = No such file or directory
</pre></div>
</div>
</div>
</div>
<p>Şekil 8.1: Tek nota icrası içeren ses sinyali dalga formu</p>
<p>Kaydı dinlediğinizde C5 notasını icrasını duyacaksınız.</p>
<p>Dalga formunu yakından görmek için sinyalin orta bölgesinden daha küçük bir kesitini inceleyelim. Değerleri orta bölgeden 500 örnek içerecek şekilde seçtik.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baslangic_endeks</span> <span class="o">=</span> <span class="mi">65000</span>
<span class="n">bitis_endeks</span> <span class="o">=</span> <span class="mi">65500</span>
<span class="n">muzik_sinyali_kesit</span> <span class="o">=</span> <span class="n">muzik_sinyali_3s</span><span class="p">[</span><span class="n">baslangic_endeks</span><span class="p">:</span><span class="n">bitis_endeks</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muzik_sinyali_kesit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flüt sinyali örneği (C5 notası icrası) - kesit&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;zaman endeksi (n)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;x[n]&#39;</span><span class="p">);</span>
<span class="n">Audio</span><span class="p">(</span><span class="n">muzik_sinyali_kesit</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<audio  controls="controls" >
    <source src="data:audio/wav;base64,UklGRgwEAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YegDAADVdbZ6z3zlfbp7U3UUbEtg5lHPQfUvhB4fDgr+ee/o4u/ZmdMg0cXRMdWP2ZLii+3g9WgAKQgQBsoHBgrLARj5jfgD9GDpTeD23aXY0tDlynDJL8iHxFfDI8Xyxx3KTcsG0ZPaMuIb6YrxP/jW+S74LvbY87ruJOnj5Qvj3N0J2IzU2tKRz/rNr9By1LLZ7eEA7YD5ygXDEqYgFC+CO25H/1OzXitnXW9pdvd5/3tafYJ6QnOkadpdOU8RPyYtvRueCwH8Gu1I4fzYF9Nz0J7QmdM02i7jMOxd9+gGqwjTBRwLOgoB/jb4lvjL8A/mrOAz3EvVjc7cyl7JY8auw+rDoMa6yMvIjsoG03TdLuPz6zP1KftP/Fj6yviJ9aDurukT5xzj+9yh18DUbtE2zujNP9BL0yfZb+IW7v36SAcrFX8juDGxPodLqFfnYP9obnGpd196Z3wDfSd51nEeaP1bBU3hO3kqSBrFCrj64uu94NnYBtON0DbSjNR12eDiRe9Y/MIBsAWvCSkKhQNp/BP8P/aU63fmROJo2i3SuM5IzKnGAMP8w6nGI8WLxWzIJc7e15/fT+kQ8275XP3N/ST8UPgz8+LtRulZ5UTgrdq71W7RYs4lzHTM0s4x03nagOSX8M39LQuxGDgnDjY7Q2RPKVpoY/FrBnOLeDN8sX1NfDB3mm+2ZURY+UfNNgkmFRafBW/1/efU3aXWHNJq0N/RJNRj2zrmX/EF/R4BowaiCmEJKgJU/Uv7n/Tv6lnlfOEn2+fTGM8UzI7IssTDxEnGgscNxr7HINES1gjclefg84z6Qv1y/tb9lvhj8jDuV+vJ5WPf4drz1p7Sns4yzc7Nzs8b1KnbouZA8q7+mQwHGxUp1jY/RJNQJVswZO1sJHS/eFZ8cH5sfVd4c3AvZgdYVEfjNSclSRSBAh3yWeUE227T7M4czpHPYNQR3NHpjvJY/D8FQwgkDZ4HEAKsAnf7IvHZ63/mVt6q1X/Rks0eyEHEaMNkxNDD1cINxODLdtO22AbkW/DK+D7+pAD7AJn9kfe+8dntouiJ4hDeONlg1BPQeM03zCrNb88X1Yre1uiw9PYB8w+IHaAr6znbRqBRXVweZrhubXU8epJ+/3/hfCx4lXAEZPJUkkMgMrgg/Q2d/LbtUeFK1y3Qo82jzf7OU9VA39HrLvbw/WoJdgzKBy0JjgWU/vH3tu9667jjttrn1Q/Ra8p9xhrFtsMswx/EEsPCyBjPAtJF3DXp2PGA+Sj/1AHe/576ifVw8bfryeVi4fLckNcX0+jPVc1rzL3NXdHM10jh4uv697AFIxMgIS4vvztHSKhT" type="audio/wav" />
    Your browser does not support the audio element.
</audio>
</div><img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_16_1.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_16_1.png" />
</div>
</div>
<p>Şekil 8.2: Tek nota icrası içeren ses sinyali dalga formu (yakınlaştırılmış)</p>
<p>Şekilde bir temel dalga formunun kendini tekrarladığını görebiliyoruz. Yaklaşık bir hesapla kendini tekrar eden ana dalga formunun frekansını hesaplayalım:</p>
<p>Bu 500 örnekli sinyalde toplamda yaklaşık 6 periyod gözlüyoruz. Örnek sayısı cinsinden periyodumuzu yaklaşık 500/6 örnek olarak alalım. 1 saniyede 44100 örnek bulunduğu için (dosyayı okurken örnekleme frekansımızı 44100 Hz olarak seçmiştik), bu durumda 1 saniyede toplam;
44100 / (500/6) adet dalga bulunduğunu, bu sayının saniyedeki tekrar sayısı olan temel titreşim frekansına karşılık geldiğini düşünebiliriz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gözleme dayalı hesaplanan temel titreşim frekansı:&quot;</span><span class="p">,</span> <span class="mi">44100</span><span class="o">/</span><span class="p">(</span><span class="mi">500</span><span class="o">/</span><span class="mi">6</span><span class="p">),</span> <span class="s2">&quot;Hz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;C5 notasının standart frekansı:&quot;</span><span class="p">,</span> <span class="n">nota_frekanslari</span><span class="p">[</span><span class="s2">&quot;C5&quot;</span><span class="p">],</span> <span class="s2">&quot;Hz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gözleme dayalı hesaplanan temel titreşim frekansı: 529.2 Hz
C5 notasının standart frekansı: 523.25 Hz
</pre></div>
</div>
</div>
</div>
<p>Gözlemle, dalga formunun uzunluğu (periyod) üzerinden, temel titreşim frekansı hesaplayabildik ve bunu icra edilen notanın frekansı ile karşılaştırarak doğrulayabildik. Peki her müzik sinyalinin analizi için bunu mu yapacağız? Elbette hayır, temel titreşim frekansını otomatik bulan fonksiyonlar yazıp kullanmayı tercih edeceğiz. Ezgi analizine başlamak için öncelikle her küçük kesit için otomatik kestirim yapabilmemiz lazım. Öncelikle bu küçük kesitteki temel titreşim frekans değişimini hazır bir kütüphane fonksiyonu yardımı ile kestirelim. 10 milisaniyede bir ölçüm yapalım ve ölçüm sonucumuzu spektrogram ile beraber çizdirelim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pencere_kaydirma_miktari</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.01</span><span class="o">*</span><span class="n">ornekleme_fr</span><span class="p">)</span> <span class="c1"># pencere kaydırma miktarını 10 milisaniye olarak seçip örnek sayısı cinsinden ifade ettik</span>
<span class="n">pencere_genisligi</span> <span class="o">=</span> <span class="n">pencere_kaydirma_miktari</span> <span class="o">*</span> <span class="mi">3</span> <span class="c1"># pencere boyutumuzu da kaydırma miktarına orantılı belirleyelim: 3 kat</span>

<span class="c1"># Hazır fonksiyon ile temel titreşim frekansı kestirimi</span>
<span class="n">f0</span><span class="p">,</span> <span class="n">periyodiklik</span><span class="p">,</span> <span class="n">periyodiklik_olasiligi</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">pyin</span><span class="p">(</span><span class="n">muzik_sinyali_3s</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">win_length</span><span class="o">=</span><span class="n">pencere_genisligi</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">pencere_kaydirma_miktari</span><span class="p">)</span>

<span class="c1"># periyodik olmayan bölgelerde kestirilen frekansları sıfırlayalım</span>
<span class="n">f0</span><span class="p">[</span><span class="o">~</span><span class="n">periyodiklik</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Librosa ile spektrogram hesabı</span>
<span class="n">fft_N</span> <span class="o">=</span> <span class="mi">4096</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">muzik_sinyali_3s</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">fft_N</span><span class="p">)</span> 
<span class="n">S_db</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">D</span><span class="p">),</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

<span class="c1"># Spektrogram matrisinin çizdirilmesi</span>
<span class="n">zamanEkseni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">S_db</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">pencere_kaydirma_miktari</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="p">)</span>
<span class="n">frekansEkseniHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">S_db</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">fft_N</span><span class="p">)</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flüt sinyali örneği (C5 notası icrası)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">zamanEkseni</span><span class="p">,</span> <span class="n">frekansEkseniHz</span><span class="p">,</span> <span class="n">S_db</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">])</span> <span class="c1"># spektrogramın 0-3000 Hz arası bölümünü görselleştirelim</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frekans(Hz)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Librosa.pyin fonksiyonu ile kestirilen frekans değerleri&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f0 (Hz)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pencere endeksi (n)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_21_0.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_21_0.png" />
</div>
</div>
<p>Şekil 8.3: Spektrogram (yakınlaştırılmış) ve librosa.pyin fonksiyonu ile elde edilen frekans serisi</p>
<p>Spektrogramı, librosa.pyin fonksiyonu ile kestirilen değerler ile karşılaştırdığımızda gerçekten de kestirilen frekanslarda spektrogramda güçlü bileşenlerin bulunduğunu rahatlıkla görebiliyoruz. Peki librosa.pyin bu kestirim işlemini nasıl gerçekleştiriyor? PYIN algoritmasının detayları için <a class="reference external" href="https://ieeexplore.ieee.org/document/6853678">ilgili makale</a>yi inceleyebilirsiniz. PYIN ve diğer birçok algoritma sinyalin kendi üzerinde kaydırılıp tekrar örtüşme noktalarının bulunması yöntemine dayanır. PYIN, sinyali kaydırılmış halinden çıkartıp farkın en düşük olduğu kaydırma miktarlarını bularak gerçekleştirir. Bu işlemin diğer alternatifi sinyali kaydırılmış haliyle çarpıp, çarpım sonucunun büyük olduğu kaydırma miktarlarını bulmaktır. Bu literatürde “otokorelasyon temelli frekans kestirimi” olarak anılır ve PYIN’in öncülü bir algoritmadır. Aşağıda bunu gerçekleştiren bir fonksiyon yazalım ve sinyalimiz üzerinde test edelim.</p>
<p>Bir <span class="math notranslate nohighlight">\(x[n]\)</span> sinyalinin otokorelasyonunu (İng:<a class="reference external" href="http://en.wikipedia.org/wiki/Autocorrelation">autocorrelation</a>) , <span class="math notranslate nohighlight">\(r_k\)</span>, aşağıdaki gibi tanımlayabiliriz:</p>
<div class="math notranslate nohighlight">
\[ r_k = \sum_n x[n] x[n+k] \]</div>
<p>Bu, temelde sinyali sinyalin <span class="math notranslate nohighlight">\(k\)</span> örnek kaydırılmış haliyle skaler çarpımına karşılık gelir. Periyodik bir <span class="math notranslate nohighlight">\(x[n]\)</span> sinyali için farklı <span class="math notranslate nohighlight">\(k\)</span> değerleri ile <span class="math notranslate nohighlight">\(r_k\)</span>’yı hesaplayıp çizdirirsek periyodun tam katlarında sinyalin kaydırılmış hali kendiyle örtüşeceğinden skaler çarpımın yüksek olmasını bekleriz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">otokorelasyon</span><span class="p">(</span><span class="n">x_n</span><span class="p">):</span>
  <span class="n">otokor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_n</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">x_n_kaydirilmis</span> <span class="o">=</span> <span class="n">x_n</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">x_n_kaydirilmis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">x_n</span><span class="p">[:</span><span class="o">-</span><span class="n">k</span><span class="p">]))</span>
    <span class="n">otokor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="n">x_n_kaydirilmis</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">otokor</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">otokor_x_n</span> <span class="o">=</span> <span class="n">otokorelasyon</span><span class="p">(</span><span class="n">muzik_sinyali_kesit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">otokor_x_n</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sinyal kesitinin otokorelasyonu&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;r[n]&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;zaman endeksi (n)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_25_0.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_25_0.png" />
</div>
</div>
<p>Şekil 8.4: Otokorelasyon sinyali örneği</p>
<p>Otokorelasyon sinyalinde periyodun tam katlarında tepeler gözlüyoruz. Otokorelasyon sinyalinin, sinyalin orijinalinden temel farkı: 0(sıfır) endeksinin ilk periyodun başı olması ve böylece sonraki periyodun başını ilk tepenin yerini bularak kestirme imkanımızın bulunması. Otokorelasyon sinyalinde 50 ve 150 örnekler arasındaki tepenin konumunu bulduğumuzda periyod bilgisine erişmiş oluruz ve periyod bilgisinden de frekansı kestirebiliriz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">periyod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">otokor_x_n</span><span class="p">[</span><span class="mi">50</span><span class="p">:</span><span class="mi">150</span><span class="p">])</span> <span class="o">+</span> <span class="mi">50</span>
<span class="n">frekans</span> <span class="o">=</span> <span class="n">ornekleme_fr</span> <span class="o">/</span> <span class="n">periyod</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Otokorelasyon tepe noktası endeksi:&quot;</span><span class="p">,</span> <span class="n">periyod</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Otokorelasyondan kestirilen frekans:&quot;</span><span class="p">,</span> <span class="n">frekans</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Otokorelasyon tepe noktası endeksi: 83
Otokorelasyondan kestirilen frekans: 531.3253012048193 Hz
</pre></div>
</div>
</div>
</div>
<p>Otokorelasyon sinyalinden frekans kestirimi yapabileceğimizi bir örnekle görmüş olduk. Otokorelasyon sinyalinde birçok tepe varolduğu için belirli bir aralıktaki tepeyi aramak işimizi kolaylaştıracaktır. Eğer maksimum periyod ve minimum periyod için bir öngörümüz var ise bu aralıktaki tepeyi aramamız yeterli olacaktır. Çoğunlukla örnek sayısı cinsinden periyod yerine minimum frekans ve maksimum frekans için öngörümüz vardır ve periyod bilgisini de frekans bilgisinden elde edebiliriz. Örneğin elimizdeki sinyal bir konuşma sinyali ise sinyalin frekansının 60 Hz-500 Hz arasında olduğunu varsayarak ilerleyebiliriz. Aşağıda sunulan, minimum ve maksimum frekans öngörüsünü kullanarak frekans kestirim yapan fonksiyonu inceleyiniz:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">frekans_kestir_otokorelasyon</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">minF0</span><span class="p">,</span> <span class="n">maxF0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Otokorelasyon yöntemi ile frekans kestirimi</span>
<span class="sd">    Parametreler</span>
<span class="sd">    ----------</span>
<span class="sd">    x_n : numpy.array</span>
<span class="sd">        Sinyal kesiti</span>
<span class="sd">    ornekleme_fr,minF0,maxF0 : float/int</span>
<span class="sd">        Örnekleme frekansı, minimum ve maksimum frekans değerleri</span>
<span class="sd">        </span>
<span class="sd">    Çıktı</span>
<span class="sd">    -------</span>
<span class="sd">    f0 : float</span>
<span class="sd">        Kestirien frekans (Hz) </span>
<span class="sd">    &#39;&#39;&#39;</span> 
    <span class="n">f0</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Ilk olarak limitleri frekanstan periyod bilgisine dönüştürelim</span>
    <span class="n">minT0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="o">/</span><span class="n">maxF0</span><span class="p">)</span>
    <span class="n">maxT0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="o">/</span><span class="n">minF0</span><span class="p">)</span>
    <span class="c1"># minT0-maxT0 arasındaki kaydırma değerlerinde otokorelasyonun </span>
    <span class="c1">#  en yüksek değer aldığı kaydırma miktarını bulmayı hedefliyoruz </span>
    <span class="n">max_deger</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">T0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minT0</span><span class="p">,</span> <span class="n">maxT0</span><span class="p">):</span>
        <span class="n">x_n_kaymis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">x_n</span><span class="p">[:</span><span class="o">-</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">otokor_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="n">x_n_kaymis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">otokor_k</span> <span class="o">&gt;</span> <span class="n">max_deger</span><span class="p">:</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">max_deger</span> <span class="o">=</span> <span class="n">otokor_k</span>
    <span class="c1"># T0 değişkeni maksimum noktanın endeksini içeriyor, örnek sayısı cinsinden </span>
    <span class="c1"># periyod bilgisine karşılık geliyor, frekansa dönüştürelim </span>
    <span class="n">f0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="p">)</span> <span class="o">/</span> <span class="n">T0</span>
    <span class="k">return</span> <span class="n">f0</span>
</pre></div>
</div>
</div>
</div>
<p>Şimdi fonksiyonumuzu C5 notasını icra eden flüt kaydı üzerinde test edelim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">minF0</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># Hz cinsinden beklenen en düşük frekans </span>
<span class="n">maxF0</span> <span class="o">=</span> <span class="mi">2000</span> <span class="c1"># Hz cinsinden beklenen en yüksek frekans</span>
<span class="n">pencere_genisligi</span> <span class="o">=</span> <span class="mi">4096</span>
<span class="n">pencere_kaydirma_miktari</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="s1">&#39;blackman&#39;</span><span class="p">,</span> <span class="n">pencere_genisligi</span><span class="p">)</span>
<span class="n">baslangic_noktalari</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">muzik_sinyali_3s</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">pencere_genisligi</span><span class="p">,</span> <span class="n">pencere_kaydirma_miktari</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
<span class="n">pencere_sayisi</span> <span class="o">=</span> <span class="n">baslangic_noktalari</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sinyali kesit/pencerelere bölüp her bir pencere için frekans kestirimi yapalım</span>
<span class="n">f0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">baslangic_noktalari</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pencere_sayisi</span><span class="p">):</span>
    <span class="n">x_n</span> <span class="o">=</span> <span class="n">muzik_sinyali_3s</span><span class="p">[</span><span class="n">baslangic_noktalari</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">:</span> <span class="n">baslangic_noktalari</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">pencere_genisligi</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span> <span class="c1"># pencereleme işlemi</span>
    <span class="n">f0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">frekans_kestir_otokorelasyon</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">minF0</span><span class="p">,</span> <span class="n">maxF0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kestirilen frekans değerlerini çizdirelim</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flüt sinyali örneği (C5 notası icrası)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;frekans_kestir_otokorelasyon() fonksiyonu ile kestirilen frekans değerleri&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f0 (Hz)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pencere endeksi (n)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_34_0.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_34_0.png" />
</div>
</div>
<p>Şekil 8.5: Otokorelasyon yöntemi ile elde edilen frekans serisi</p>
<p>Kaydın iki kenarında sessizlik var. O bölgelerdeki değerleri sıfırlayabiliriz. Bunu enerji parametresini kullanarak gerçekleştirelim. Enerjinin maksimum enerjinin %5’inin altına düştüğü pencereleri sessiz bölgeler olarak ele alacağız.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enerji hesabı </span>
<span class="n">NRG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pencere_sayisi</span><span class="p">):</span>
    <span class="n">x_n</span> <span class="o">=</span> <span class="n">muzik_sinyali_3s</span><span class="p">[</span><span class="n">baslangic_noktalari</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span><span class="n">baslangic_noktalari</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">pencere_genisligi</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span>
    <span class="n">NRG</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Enerjinin maksimumunun %5&#39;i altındaki bölgelerde frekans değerlerinin sıfırlanması</span>
<span class="n">esik_deger_oran</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">f0</span><span class="p">[</span><span class="n">NRG</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">NRG</span><span class="p">)</span><span class="o">*</span><span class="n">esik_deger_oran</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Kestirilen frekans değerlerini çizdirelim</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flüt sinyali örneği (C5 notası icrası)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;frekans_kestir_otokorelasyon() fonksiyonu ile kestirilen frekans değerleri&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f0 (Hz)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pencere endeksi (n)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_37_0.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_37_0.png" />
</div>
</div>
<p>Şekil 8.6: Otokorelasyon yöntemi ile elde edilen frekans serisi (sinyalin enerjisi düşük bölgelerinde frekans sıfırlandıktan sonra)</p>
<p>Şimdi kendi yazdığımız fonksiyon ve librosa.pyin fonksiyonu ile sinyalin tümü üzerinde frekans kestirimi yapıp sonuçları karşılaştıralım.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pencere_kaydirma_miktari</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.01</span><span class="o">*</span><span class="n">ornekleme_fr</span><span class="p">)</span> <span class="c1"># pencere kaydırma miktarını 10 milisaniye olarak seçip örnek sayısı cinsinden ifade ettik</span>
<span class="n">pencere_genisligi</span> <span class="o">=</span> <span class="n">pencere_kaydirma_miktari</span> <span class="o">*</span> <span class="mi">3</span> <span class="c1"># pencere boyutumuzu da kaydırma miktarına orantılı belirleyelim: 3 kat</span>
<span class="n">minF0</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># minimum frekans</span>
<span class="n">maxF0</span> <span class="o">=</span> <span class="mi">2000</span> <span class="c1"># maximum frekans</span>

<span class="c1"># Librosa.pyin hazır fonksiyonu ile temel titreşim frekansı kestirimi</span>
<span class="n">f0_pyin</span><span class="p">,</span> <span class="n">periyodiklik</span><span class="p">,</span> <span class="n">periyodiklik_olasiligi</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">pyin</span><span class="p">(</span><span class="n">muzik_sinyali</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">minF0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">maxF0</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">win_length</span><span class="o">=</span><span class="n">pencere_genisligi</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">pencere_kaydirma_miktari</span><span class="p">)</span>

<span class="c1"># periyodik olmayan bölgelerde kestirilen frekansları sıfırlayalım</span>
<span class="n">f0_pyin</span><span class="p">[</span><span class="o">~</span><span class="n">periyodiklik</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Otokorelasyon temelli frekans kestirimi</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="s1">&#39;blackman&#39;</span><span class="p">,</span> <span class="n">pencere_genisligi</span><span class="p">)</span>
<span class="n">baslangic_noktalari</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">muzik_sinyali</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">pencere_genisligi</span><span class="p">,</span> <span class="n">pencere_kaydirma_miktari</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
<span class="n">pencere_sayisi</span> <span class="o">=</span> <span class="n">baslangic_noktalari</span><span class="o">.</span><span class="n">size</span>
<span class="n">f0_otokor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">baslangic_noktalari</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">NRG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f0_otokor</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pencere_sayisi</span><span class="p">):</span> 
    <span class="n">x_n</span> <span class="o">=</span> <span class="n">muzik_sinyali</span><span class="p">[</span><span class="n">baslangic_noktalari</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">:</span> <span class="n">baslangic_noktalari</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">pencere_genisligi</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span> <span class="c1"># pencereleme işlemi</span>
    <span class="n">f0_otokor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">frekans_kestir_otokorelasyon</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">minF0</span><span class="p">,</span> <span class="n">maxF0</span><span class="p">)</span>
    <span class="n">NRG</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">esik_deger_oran</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">f0_otokor</span><span class="p">[</span><span class="n">NRG</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">NRG</span><span class="p">)</span><span class="o">*</span><span class="n">esik_deger_oran</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Ölçülen frekans değerlerinin üstüste çizdirilmesi</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flüt sinyali örneği&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f0_pyin</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PYIN kestirim sonucu&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f0_otokor</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Otokorelasyon ile kestirim sonucu&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;frekans_kestir_otokorelasyon() fonksiyonu ile kestirilen frekans değerleri&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f0 (Hz)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pencere endeksi (n)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_40_0.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_40_0.png" />
</div>
</div>
<p>Şekil 8.7: Librosa.pyin ve otokorelasyon yöntemi ile elde edilen frekans serileri</p>
<p>Sonuçların birçok noktada örtüştüğünü, pyin’in sondan önceki notada frekansı yarısı değerinde kestirdiğini (oktav hatası yaptığını) görebiliyoruz. Oktav hatası (frekansı doğru değerinden *<span class="math notranslate nohighlight">\(2^k\)</span> farklı olarak tespit etmek, <span class="math notranslate nohighlight">\(k\)</span> tamsayı) yapılan en tipik hatalardandır.</p>
<section id="frekans-kestirim-algoritmasinin-test-edilmesi">
<h3><span class="section-number">8.1.1. </span>Frekans kestirim algoritmasının test edilmesi<a class="headerlink" href="#frekans-kestirim-algoritmasinin-test-edilmesi" title="Permalink to this headline">#</a></h3>
<p>Peki, yapılan frekans kestirim sonucunun doğruluğunu nasıl ölçebiliriz? Elimizdeki veriler sentetik değilse gerçek frekans değerinden emin olmamız mümkün değildir. Ancak başka özniteliklerle (örneğin spektrogram ile) karşılaştırmak veya elle işaretlemesi yapılmış veriler üzerinden standart testler gerçekleştirmek şeklinde opsiyonlarımız bulunmakta. Bu örnek için spektrogram ile beraber çizdirerek karşılaştırmaya bir örnek görelim.</p>
<section id="baska-ozniteliklerle-ornegin-spektrogram-ile-karsilastirmak">
<h4><span class="section-number">8.1.1.1. </span>Başka özniteliklerle (örneğin spektrogram ile) karşılaştırmak<a class="headerlink" href="#baska-ozniteliklerle-ornegin-spektrogram-ile-karsilastirmak" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fft_N</span> <span class="o">=</span> <span class="mi">4096</span>
<span class="n">spktrgrm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fft_N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="c1"># spektogram boş bir dizi olarak başlatılıyor</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pencere_sayisi</span><span class="p">):</span>
    <span class="n">pencere_baslangici</span> <span class="o">=</span> <span class="n">baslangic_noktalari</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">x_w</span> <span class="o">=</span> <span class="n">muzik_sinyali</span><span class="p">[</span><span class="n">pencere_baslangici</span><span class="p">:</span><span class="n">pencere_baslangici</span> <span class="o">+</span> <span class="n">pencere_genisligi</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">x_w</span><span class="p">,</span> <span class="n">fft_N</span><span class="p">)</span>
    <span class="n">genlikX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">fft_N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)])</span>
    <span class="n">genlikX</span><span class="p">[</span><span class="n">genlikX</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span> <span class="c1"># log operasyonundan önce önlem</span>
    <span class="n">genlik_spektrumu</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">genlikX</span><span class="p">)</span>
    <span class="n">spktrgrm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">spktrgrm</span><span class="p">,</span> <span class="n">genlik_spektrumu</span><span class="p">))</span> <span class="c1"># k. sinyal kesitinin spektrumunun eklenmesi</span>

<span class="c1"># Spektrogram matrisinin çizdirilmesi</span>
<span class="n">zamanEkseni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">spktrgrm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">pencere_kaydirma_miktari</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="p">)</span>
<span class="n">frekansEkseniHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">spktrgrm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">ornekleme_fr</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">fft_N</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">zamanEkseni</span><span class="p">,</span> <span class="n">frekansEkseniHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">spktrgrm</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zamanEkseni</span><span class="p">,</span> <span class="n">f0_otokor</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Otokorelasyon ile kestirim sonucu&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">])</span> <span class="c1"># spektrogramın 0-3000 Hz arası bölümünü görselleştirelim</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Genlik Spektrogramı (dB)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frekans(Hz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;zaman(saniye)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_46_0.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_46_0.png" />
</div>
</div>
<p>Şekil 8.8: Spektrogram ve otokorelasyon yöntemi ile elde edilen frekans serisi</p>
<p>Spektrogramla kestirilen frekans değerlerini üstüste çizdirdiğimizde temel titreşim frekans değerlerinin spektrogramda 1. harmonik izi ile örtüştüğünü doğrulayabiliyoruz. 15. saniye civarında yanlış kestirim yapılmış pencereler olduğu da görülebiliyor.</p>
</section>
<section id="cesitli-yontemlerin-standart-metrikler-kullanilarak-test-edilmesi">
<h4><span class="section-number">8.1.1.2. </span>Çeşitli yöntemlerin standart metrikler kullanılarak test edilmesi<a class="headerlink" href="#cesitli-yontemlerin-standart-metrikler-kullanilarak-test-edilmesi" title="Permalink to this headline">#</a></h4>
<p>Birden fazla algoritmanın kestirdiği temel titreşim frekans değerlerini, hangisinin daha iyi sonuç verdiğini anlamak için, karşılaştırmamız gerekirse bu alanda kullanılan standart test yöntemlerini kullanmamızda fayda var. Aşağıda güncel olarak kullanılan, başarım seviyesi yüksek 3 ayrı kütüphanenin standart veri ve test yöntemi ile karşılaştırılmasına yönelik kod örneği bulabilirsiniz.</p>
<p>Burada şu noktaları gözden kaçırmamak gerekir:</p>
<ul class="simple">
<li><p>Her bir algoritma için bir dizi parametre bulunmaktadır ve parametre seçimi başarı düzeyini etkileyecektir. Çeşitli parametre kombinasyonları ile testler yapıp en iyi kombinasyonları elde ettikten sonra karşılaştırma yapmak daha güvenilir bir karşılaştırma sonucu sunacaktır</p></li>
<li><p>Algoritmaların farklı ses örneklerinde başarı düzeyleri farklı olacaktır. Tekil örneklerden yola çıkarak sonuca varmak yerine çok sayıda ve farklı türde veriler üzerinde test yapıp raporlamak faydalı olacaktır</p></li>
<li><p>Frekans kestirim sonuçlarındaki bazı hatalar (örneğin oktav hataları) kural tabanlı işlemlerle düzeltilebilmektedir. Uygulama geliştirirken bu olasılık da değerlendirilmelidir.</p></li>
</ul>
<p>Testlerimizde verilere erişim ve test fonksiyonları için şu kütüphaneleri kullanacağız:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/mir-dataset-loaders/mirdata">mirdata</a>: müzik bilgi erişim alanında kullanılan bazı veri kümelerinin kolayca yüklenmesini sağlar</p></li>
<li><p><a class="reference external" href="https://github.com/craffel/mir_eval">mir_eval</a>: müzik bilgi erişim alanında standart kalite testleri gerçekleştirmek için kullanılan bir kütüphane</p></li>
</ul>
<p>Ayrıca frekans kestirim için güncel tekniklerden birisi olan Crepe algoritmasını da testlerimize dahil edeceğiz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install crepe mir_eval mirdata
<span class="kn">import</span> <span class="nn">mirdata</span><span class="o">,</span> <span class="nn">mir_eval</span><span class="o">,</span> <span class="nn">crepe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Collecting crepe
  Downloading crepe-0.0.12.tar.gz (15 kB)
Collecting mir_eval
  Downloading mir_eval-0.7.tar.gz (90 kB)
     |████████████████████████████████| 90 kB 5.2 MB/s 
?25hCollecting mirdata
  Downloading mirdata-0.3.6-py3-none-any.whl (13.1 MB)
     |████████████████████████████████| 13.1 MB 41.0 MB/s 
?25hRequirement already satisfied: numpy&gt;=1.14.0 in /usr/local/lib/python3.7/dist-packages (from crepe) (1.21.6)
Requirement already satisfied: scipy&gt;=1.0.0 in /usr/local/lib/python3.7/dist-packages (from crepe) (1.7.3)
Requirement already satisfied: matplotlib&gt;=2.1.0 in /usr/local/lib/python3.7/dist-packages (from crepe) (3.2.2)
Collecting resampy&lt;0.3.0,&gt;=0.2.0
  Downloading resampy-0.2.2.tar.gz (323 kB)
     |████████████████████████████████| 323 kB 49.7 MB/s 
?25hRequirement already satisfied: h5py in /usr/local/lib/python3.7/dist-packages (from crepe) (3.1.0)
Collecting hmmlearn&lt;0.3.0,&gt;=0.2.0
  Downloading hmmlearn-0.2.7-cp37-cp37m-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (129 kB)
     |████████████████████████████████| 129 kB 43.1 MB/s 
?25hRequirement already satisfied: imageio&gt;=2.3.0 in /usr/local/lib/python3.7/dist-packages (from crepe) (2.9.0)
Requirement already satisfied: scikit-learn&gt;=0.16 in /usr/local/lib/python3.7/dist-packages (from crepe) (1.0.2)
Requirement already satisfied: pillow in /usr/local/lib/python3.7/dist-packages (from imageio&gt;=2.3.0-&gt;crepe) (7.1.2)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.1.0-&gt;crepe) (3.0.9)
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.1.0-&gt;crepe) (2.8.2)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.1.0-&gt;crepe) (0.11.0)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.1.0-&gt;crepe) (1.4.4)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from kiwisolver&gt;=1.0.1-&gt;matplotlib&gt;=2.1.0-&gt;crepe) (4.1.1)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil&gt;=2.1-&gt;matplotlib&gt;=2.1.0-&gt;crepe) (1.15.0)
Requirement already satisfied: numba&gt;=0.32 in /usr/local/lib/python3.7/dist-packages (from resampy&lt;0.3.0,&gt;=0.2.0-&gt;crepe) (0.56.0)
Requirement already satisfied: llvmlite&lt;0.40,&gt;=0.39.0dev0 in /usr/local/lib/python3.7/dist-packages (from numba&gt;=0.32-&gt;resampy&lt;0.3.0,&gt;=0.2.0-&gt;crepe) (0.39.0)
Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from numba&gt;=0.32-&gt;resampy&lt;0.3.0,&gt;=0.2.0-&gt;crepe) (4.12.0)
Requirement already satisfied: setuptools in /usr/local/lib/python3.7/dist-packages (from numba&gt;=0.32-&gt;resampy&lt;0.3.0,&gt;=0.2.0-&gt;crepe) (57.4.0)
Requirement already satisfied: joblib&gt;=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn&gt;=0.16-&gt;crepe) (1.1.0)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn&gt;=0.16-&gt;crepe) (3.1.0)
Requirement already satisfied: future in /usr/local/lib/python3.7/dist-packages (from mir_eval) (0.16.0)
Requirement already satisfied: librosa&gt;=0.8.0 in /usr/local/lib/python3.7/dist-packages (from mirdata) (0.8.1)
Collecting pretty-midi&gt;=0.2.8
  Downloading pretty_midi-0.2.9.tar.gz (5.6 MB)
     |████████████████████████████████| 5.6 MB 48.3 MB/s 
?25hRequirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from mirdata) (2.23.0)
Collecting jams
  Downloading jams-0.3.4.tar.gz (51 kB)
     |████████████████████████████████| 51 kB 85 kB/s 
?25hRequirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from mirdata) (4.64.0)
Requirement already satisfied: smart-open&gt;=5.0.0 in /usr/local/lib/python3.7/dist-packages (from mirdata) (5.2.1)
Requirement already satisfied: chardet in /usr/local/lib/python3.7/dist-packages (from mirdata) (3.0.4)
Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from mirdata) (6.0)
Collecting Deprecated&gt;=1.2.13
  Downloading Deprecated-1.2.13-py2.py3-none-any.whl (9.6 kB)
Requirement already satisfied: wrapt&lt;2,&gt;=1.10 in /usr/local/lib/python3.7/dist-packages (from Deprecated&gt;=1.2.13-&gt;mirdata) (1.14.1)
Requirement already satisfied: cached-property in /usr/local/lib/python3.7/dist-packages (from h5py-&gt;crepe) (1.5.2)
Requirement already satisfied: packaging&gt;=20.0 in /usr/local/lib/python3.7/dist-packages (from librosa&gt;=0.8.0-&gt;mirdata) (21.3)
Requirement already satisfied: pooch&gt;=1.0 in /usr/local/lib/python3.7/dist-packages (from librosa&gt;=0.8.0-&gt;mirdata) (1.6.0)
Requirement already satisfied: decorator&gt;=3.0.0 in /usr/local/lib/python3.7/dist-packages (from librosa&gt;=0.8.0-&gt;mirdata) (4.4.2)
Requirement already satisfied: audioread&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from librosa&gt;=0.8.0-&gt;mirdata) (3.0.0)
Requirement already satisfied: soundfile&gt;=0.10.2 in /usr/local/lib/python3.7/dist-packages (from librosa&gt;=0.8.0-&gt;mirdata) (0.10.3.post1)
Requirement already satisfied: appdirs&gt;=1.3.0 in /usr/local/lib/python3.7/dist-packages (from pooch&gt;=1.0-&gt;librosa&gt;=0.8.0-&gt;mirdata) (1.4.4)
Collecting mido&gt;=1.1.16
  Downloading mido-1.2.10-py2.py3-none-any.whl (51 kB)
     |████████████████████████████████| 51 kB 8.5 MB/s 
?25hRequirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests-&gt;mirdata) (2022.6.15)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /usr/local/lib/python3.7/dist-packages (from requests-&gt;mirdata) (2.10)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests-&gt;mirdata) (1.24.3)
Requirement already satisfied: cffi&gt;=1.0 in /usr/local/lib/python3.7/dist-packages (from soundfile&gt;=0.10.2-&gt;librosa&gt;=0.8.0-&gt;mirdata) (1.15.1)
Requirement already satisfied: pycparser in /usr/local/lib/python3.7/dist-packages (from cffi&gt;=1.0-&gt;soundfile&gt;=0.10.2-&gt;librosa&gt;=0.8.0-&gt;mirdata) (2.21)
Requirement already satisfied: zipp&gt;=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata-&gt;numba&gt;=0.32-&gt;resampy&lt;0.3.0,&gt;=0.2.0-&gt;crepe) (3.8.1)
Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from jams-&gt;mirdata) (1.3.5)
Requirement already satisfied: sortedcontainers&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from jams-&gt;mirdata) (2.4.0)
Requirement already satisfied: jsonschema&gt;=3.0.0 in /usr/local/lib/python3.7/dist-packages (from jams-&gt;mirdata) (4.3.3)
Requirement already satisfied: importlib-resources&gt;=1.4.0 in /usr/local/lib/python3.7/dist-packages (from jsonschema&gt;=3.0.0-&gt;jams-&gt;mirdata) (5.9.0)
Requirement already satisfied: pyrsistent!=0.17.0,!=0.17.1,!=0.17.2,&gt;=0.14.0 in /usr/local/lib/python3.7/dist-packages (from jsonschema&gt;=3.0.0-&gt;jams-&gt;mirdata) (0.18.1)
Requirement already satisfied: attrs&gt;=17.4.0 in /usr/local/lib/python3.7/dist-packages (from jsonschema&gt;=3.0.0-&gt;jams-&gt;mirdata) (22.1.0)
Requirement already satisfied: pytz&gt;=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas-&gt;jams-&gt;mirdata) (2022.2.1)
Building wheels for collected packages: crepe, resampy, mir-eval, pretty-midi, jams
  Building wheel for crepe (setup.py) ... ?25l?25hdone
  Created wheel for crepe: filename=crepe-0.0.12-py3-none-any.whl size=134848696 sha256=dd0771d7f13d72d7133e4f813a5e4957ea767e5918b5412138f5646871eab606
  Stored in directory: /root/.cache/pip/wheels/56/05/32/fccf64e8ae720b34b486b6a8a08712777fd0beab419980fea3
  Building wheel for resampy (setup.py) ... ?25l?25hdone
  Created wheel for resampy: filename=resampy-0.2.2-py3-none-any.whl size=320732 sha256=b9ce4d365b1facbd44c7909aba6541bd219c4c0dc4c4ed2fcc8161533eddc21b
  Stored in directory: /root/.cache/pip/wheels/a0/18/0a/8ad18a597d8333a142c9789338a96a6208f1198d290ece356c
  Building wheel for mir-eval (setup.py) ... ?25l?25hdone
  Created wheel for mir-eval: filename=mir_eval-0.7-py3-none-any.whl size=100721 sha256=b128be6f46da0f9588f89b32948ab0be8b22a611bc344426b26b50dd3a193d68
  Stored in directory: /root/.cache/pip/wheels/18/5a/46/d2527ff1fd975e1a793375e6ed763bfe4d3ea396b7cdc470eb
  Building wheel for pretty-midi (setup.py) ... ?25l?25hdone
  Created wheel for pretty-midi: filename=pretty_midi-0.2.9-py3-none-any.whl size=5591955 sha256=40ec4aad7f839d33f2cee924dd5b908a6d7f47edfe94fa88a1345e62fe0b56ca
  Stored in directory: /root/.cache/pip/wheels/ad/74/7c/a06473ca8dcb63efb98c1e67667ce39d52100f837835ea18fa
  Building wheel for jams (setup.py) ... ?25l?25hdone
  Created wheel for jams: filename=jams-0.3.4-py3-none-any.whl size=64922 sha256=99c48004aecebb2b709360ab6e43f1f4992115529e437cc5488e71ff7ffdf3a2
  Stored in directory: /root/.cache/pip/wheels/c9/aa/16/ce72bc4caa58dfab819e3f46b3542f2bf90a83009f4ea07a48
Successfully built crepe resampy mir-eval pretty-midi jams
Installing collected packages: resampy, mir-eval, mido, pretty-midi, jams, hmmlearn, Deprecated, mirdata, crepe
  Attempting uninstall: resampy
    Found existing installation: resampy 0.4.0
    Uninstalling resampy-0.4.0:
      Successfully uninstalled resampy-0.4.0
Successfully installed Deprecated-1.2.13 crepe-0.0.12 hmmlearn-0.2.7 jams-0.3.4 mido-1.2.10 mir-eval-0.7 mirdata-0.3.6 pretty-midi-0.2.9 resampy-0.2.2
</pre></div>
</div>
</div>
</div>
<p>mirdata aracılığıyla erişilebilen veri kümelerinin listesi için <a class="reference external" href="https://mirdata.readthedocs.io/en/stable/source/quick_reference.html">bakınız</a>. Listelenen veriler içerisinde F0 etiketleri içerenlerden birisi olan “vocadito”yu kullanacağız.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verilerin indirilmesi</span>
<span class="n">vocadito</span> <span class="o">=</span> <span class="n">mirdata</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="s1">&#39;vocadito&#39;</span><span class="p">)</span>
<span class="n">vocadito</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
<span class="c1"># İndirilen verilerdeki dosya bilgilerinin yüklenmesi</span>
<span class="n">dosyalar</span> <span class="o">=</span> <span class="n">vocadito</span><span class="o">.</span><span class="n">load_tracks</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>55.8MB [01:56, 501kB/s]                            
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analiz parametrelerinin belirlenmesi </span>
<span class="n">ornekleme_fr</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="n">pencere_kaydirma_miktari</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.005</span><span class="o">*</span><span class="n">ornekleme_fr</span><span class="p">)</span>
<span class="n">pencere_genisligi</span> <span class="o">=</span> <span class="n">pencere_kaydirma_miktari</span> <span class="o">*</span> <span class="mi">6</span>
<span class="n">minF0</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">maxF0</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># vokal örneği üzerinde kestirim yapacağımız için üst limiti düşük tutabiliriz</span>
</pre></div>
</div>
</div>
</div>
<p>Aşağıdaki kod bir ses dosyası için üç algoritmanın frekans kestirim sonuçlarının karşılaştırmasını gerçekleştirir. Çalıştırıp sonucu aldıktan sonra isterseniz ilk satırı değiştirip analizi tüm veriler üzerinde işletebilirsiniz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for dosya_ismi in dosyalar.keys(): # veri kümesindeki tüm dosyalar için test yapmak isterseniz bir alttaki yerine bu satırı kullanabilirsiniz</span>
<span class="k">for</span> <span class="n">dosya_ismi</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]:</span> <span class="c1"># listeye isterseniz başka örneklerin endekslerini (virgülle ayırarak) ekleyebilirsiniz</span>
  <span class="n">dosya</span> <span class="o">=</span> <span class="n">dosyalar</span><span class="p">[</span><span class="n">dosya_ismi</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ses dosyası konumu:&#39;</span><span class="p">,</span> <span class="n">dosya</span><span class="o">.</span><span class="n">audio_path</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Etiket dosyası konumu:&#39;</span><span class="p">,</span> <span class="n">dosya</span><span class="o">.</span><span class="n">f0_path</span><span class="p">)</span>
  <span class="c1"># Ses dosyasının okunması</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">ess</span><span class="o">.</span><span class="n">MonoLoader</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">dosya</span><span class="o">.</span><span class="n">audio_path</span><span class="p">,</span> <span class="n">sampleRate</span> <span class="o">=</span> <span class="n">ornekleme_fr</span><span class="p">)()</span>
  
  <span class="c1"># Melodia ile temel titreşim frekans kestirimi</span>
  <span class="n">frekans_serisi_melodia</span><span class="p">,</span> <span class="n">guvenilirlik</span> <span class="o">=</span> <span class="n">ess</span><span class="o">.</span><span class="n">PitchMelodia</span><span class="p">(</span><span class="n">guessUnvoiced</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                                  <span class="n">frameSize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pencere_genisligi</span><span class="p">),</span> 
                                                  <span class="n">hopSize</span> <span class="o">=</span> <span class="n">pencere_kaydirma_miktari</span><span class="p">,</span>
                                                  <span class="n">maxFrequency</span> <span class="o">=</span> <span class="n">maxF0</span><span class="p">,</span>
                                                  <span class="n">sampleRate</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
  <span class="c1"># Güvenilirliğin düşük olduğu kestirimleri sıfırlayalım</span>
  <span class="n">frekans_serisi_melodia</span><span class="p">[</span><span class="n">guvenilirlik</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">zaman_serisi_melodia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">frekans_serisi_melodia</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 

  <span class="c1"># Crepe ile temel titreşim frekans kestirimi</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Crepe frekans kestirim işlemi gerçekleştiriliyor&#39;</span><span class="p">)</span>
  <span class="n">zaman_serisi_crepe</span><span class="p">,</span> <span class="n">frekans_serisi_crepe</span><span class="p">,</span> <span class="n">guvenilirlik</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="n">crepe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">viterbi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="c1"># Güvenilirliğin düşük olduğu kestirimleri sıfırlayalım</span>
  <span class="n">frekans_serisi_crepe</span><span class="p">[</span><span class="n">guvenilirlik</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="c1"># Librosa.pyin ile temel titreşim frekans kestirimi</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pyin frekans kestirim işlemi gerçekleştiriliyor&#39;</span><span class="p">)</span>
  <span class="n">frekans_serisi_pyin</span><span class="p">,</span> <span class="n">periyodiklik</span><span class="p">,</span> <span class="n">periyodiklik_olasiligi</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">pyin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">minF0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">maxF0</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">win_length</span><span class="o">=</span><span class="n">pencere_genisligi</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">pencere_kaydirma_miktari</span><span class="p">)</span>
  <span class="n">zaman_serisi_pyin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="n">ornekleme_fr</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">frekans_serisi_pyin</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 

  <span class="c1"># Veri etiketlerinin (doğru değerlerin) okunması</span>
  <span class="n">zaman_serisi_referans</span><span class="p">,</span> <span class="n">frekans_serisi_referans</span> <span class="o">=</span> <span class="n">mir_eval</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_time_series</span><span class="p">(</span><span class="n">dosya</span><span class="o">.</span><span class="n">f0_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

  <span class="c1"># Gerçek değerleri ile kestirilen değerlerin karşılaştırılması </span>
  <span class="n">sonuclar_melodia</span> <span class="o">=</span> <span class="n">mir_eval</span><span class="o">.</span><span class="n">melody</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">zaman_serisi_referans</span><span class="p">,</span> <span class="n">frekans_serisi_referans</span><span class="p">,</span> <span class="n">zaman_serisi_melodia</span><span class="p">,</span> <span class="n">frekans_serisi_melodia</span><span class="p">)</span>
  <span class="n">sonuclar_crepe</span> <span class="o">=</span> <span class="n">mir_eval</span><span class="o">.</span><span class="n">melody</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">zaman_serisi_referans</span><span class="p">,</span> <span class="n">frekans_serisi_referans</span><span class="p">,</span> <span class="n">zaman_serisi_crepe</span><span class="p">,</span> <span class="n">frekans_serisi_crepe</span><span class="p">)</span>
  <span class="n">sonuclar_pyin</span> <span class="o">=</span> <span class="n">mir_eval</span><span class="o">.</span><span class="n">melody</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">zaman_serisi_referans</span><span class="p">,</span> <span class="n">frekans_serisi_referans</span><span class="p">,</span> <span class="n">zaman_serisi_pyin</span><span class="p">,</span> <span class="n">frekans_serisi_pyin</span><span class="p">)</span>
  
  <span class="k">for</span> <span class="n">sonuclar</span><span class="p">,</span> <span class="n">algoritma</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">sonuclar_melodia</span><span class="p">,</span> <span class="n">sonuclar_crepe</span><span class="p">,</span> <span class="n">sonuclar_pyin</span><span class="p">],[</span><span class="s1">&#39;melodia&#39;</span><span class="p">,</span> <span class="s1">&#39;crepe&#39;</span><span class="p">,</span> <span class="s1">&#39;pyin&#39;</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">algoritma</span><span class="p">,</span> <span class="s1">&#39;algoritması için sonuçlar:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">anahtar</span><span class="p">,</span> <span class="n">deger</span> <span class="ow">in</span> <span class="n">sonuclar</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">anahtar</span><span class="p">,</span> <span class="n">deger</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ses dosyası konumu: /root/mir_datasets/vocadito/Audio/vocadito_1.wav
Etiket dosyası konumu: /root/mir_datasets/vocadito/Annotations/F0/vocadito_1_f0.csv
Crepe frekans kestirim işlemi gerçekleştiriliyor
104/104 [==============================] - 161s 2s/step
Pyin frekans kestirim işlemi gerçekleştiriliyor
----------------------
melodia algoritması için sonuçlar:
Voicing Recall 0.899505766062603
Voicing False Alarm 0.26009615384615387
Raw Pitch Accuracy 0.8833058758923669
Raw Chroma Accuracy 0.8833058758923669
Overall Accuracy 0.8311779098217407
----------------------
crepe algoritması için sonuçlar:
Voicing Recall 0.9879187259747392
Voicing False Alarm 0.08798076923076924
Raw Pitch Accuracy 0.9829763866007688
Raw Chroma Accuracy 0.9829763866007688
Overall Accuracy 0.9571828032156589
----------------------
pyin algoritması için sonuçlar:
Voicing Recall 0.9925864909390445
Voicing False Alarm 0.14951923076923077
Raw Pitch Accuracy 0.9827018121911038
Raw Chroma Accuracy 0.9827018121911038
Overall Accuracy 0.9346382383781895
</pre></div>
</div>
</div>
</div>
<p>Testlerde kullanılan başarı ölçütlerine dair açıklamalar için bakınız:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://craffel.github.io/mir_eval/#mir_eval.melody.voicing_measures">Voicing measures</a></p></li>
<li><p><a class="reference external" href="https://craffel.github.io/mir_eval/#mir_eval.melody.raw_pitch_accuracy">Raw pitch accuracy</a></p></li>
<li><p><a class="reference external" href="http://craffel.github.io/mir_eval/#mir_eval.melody.raw_chroma_accuracy">Raw chroma accuracy</a></p></li>
<li><p><a class="reference external" href="http://craffel.github.io/mir_eval/#mir_eval.melody.overall_accuracy">Overall accuracy</a></p></li>
</ul>
<p>Bu örnekte Crepe algoritmasının başarı düzeyinin diğer algoritmalardan yüksek olduğunu görebiliyoruz.</p>
<p>Son olarak frekans serilerini görsel olarak karşılaştırabiliriz. Değerler birbirine çok yakın olduğu için serileri y ekseninde kaydırarak çizdirmeyi tercih edeceğiz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ölçülen frekans değerlerinin üstüste çizdirilmesi</span>
<span class="n">kaydirma_miktari</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;vocadito veri kümesi ilk dosyası için frekans kestirim sonuçları&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zaman_serisi_referans</span><span class="p">,</span> <span class="n">frekans_serisi_referans</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Etiket değerleri&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zaman_serisi_melodia</span><span class="p">,</span> <span class="n">frekans_serisi_melodia</span><span class="o">+</span><span class="n">kaydirma_miktari</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Melodia(+</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kaydirma_miktari</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zaman_serisi_crepe</span><span class="p">,</span> <span class="n">frekans_serisi_crepe</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">kaydirma_miktari</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Crepe(+</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">kaydirma_miktari</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zaman_serisi_pyin</span><span class="p">,</span> <span class="n">frekans_serisi_pyin</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">kaydirma_miktari</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pyin(+</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">kaydirma_miktari</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f0 (Hz)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pencere endeksi (n)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8_EzgiAnalizi_FrekansKestirimi_61_0.png" src="../_images/8_EzgiAnalizi_FrekansKestirimi_61_0.png" />
</div>
</div>
<p>Şekil 8.9: Vocadito veri kümesi ilk örneği için Melodia, Crepe ve Librosa.pyin ile elde edilen frekans serileri ve etiket değerleri</p>
<p>Bu örnek için, test ettiğimiz üç algoritma ile de gerçek etiket değerlerine çok yakın değerler elde ettiğimizi grafikten görebiliyoruz. En açık hatalar: Melodia bazı sessiz bölgelerde frekans değerleri döndürmüş. Muhtemelen bu hatalar yukarıda yaptığımız gibi enerjisi düşük bölgelerde frekans sıfırlanarak düzeltilebilir. Vokal kayıtlarının çoğu için benzer sonuçları bekleyebiliriz.</p>
<p>Bu defterimizde verili bir ses kaydında icra edilen frekans serisini kestirme konusunu ele aldık. Hem kendimiz bir fonksiyon yazdık, hem de güncel hazır araçların kullanımını örnekledik. Sonraki defterde frekans serisinin işlenmesine yönelik örnekler göreceğiz.</p>
<p><strong>Yazar:</strong> Barış Bozkurt, <strong>editör:</strong> Ahmet Uysal</p>
<hr class="docutils" />
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="7_OtomatikEnstrumanTanima.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Akustik Öznitelikler ile Otomatik Enstrüman Tanıma</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="9_EntonasyonAnalizi.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Entonasyon Analizi</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Barış Bozkurt (yazar) ve Ahmet Uysal (editör)<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>